!function(a){a.Recorder=function(b,c){const d=new AudioContext;c=c||{},c.channelCount=1,c.numberOfInputChannels=c.channelCount,c.numberOfOutputChannels=c.channelCount,c.sampleBits=c.sampleBits||16,c.sampleRate=c.sampleRate||16e3,c.bufferSize=4096;const e=d.createMediaStreamSource(b),f=d.createGain();e.connect(f);const g=d.createScriptProcessor(c.bufferSize,c.channelCount,c.channelCount),h={size:0,buffer:[],inputSampleRate:d.sampleRate,inputSampleBits:16,outputSampleRate:c.sampleRate,oututSampleBits:c.sampleBits,input:function(a){this.buffer.push(new Float32Array(a)),this.size+=a.length},getRawData:function(){const a=new Float32Array(this.size);let b=0;for(let c=0;c<this.buffer.length;c++)a.set(this.buffer[c],b),b+=this.buffer[c].length;const c=parseInt(this.inputSampleRate/this.outputSampleRate),d=a.length/c,e=new Float32Array(d);for(let b=0,f=0;b<d;)e[b]=a[f],f+=c,b++;return e},getBlob(){const a=Math.min(this.inputSampleRate,this.outputSampleRate),b=Math.min(this.inputSampleBits,this.oututSampleBits),d=this.getRawData(),e=d.length*(b/8),f=new ArrayBuffer(44+e),g=new DataView(f);let h=0;const i=function(a){for(let b=0;b<a.length;b++)g.setUint8(h+b,a.charCodeAt(b))};if(i("RIFF"),h+=4,g.setUint32(h,36+e,!0),h+=4,i("WAVE"),h+=4,i("fmt "),h+=4,g.setUint32(h,16,!0),h+=4,g.setUint16(h,1,!0),h+=2,g.setUint16(h,c.channelCount,!0),h+=2,g.setUint32(h,a,!0),h+=4,g.setUint32(h,c.channelCount*a*(b/8),!0),h+=4,g.setUint16(h,c.channelCount*(b/8),!0),h+=2,g.setUint16(h,b,!0),h+=2,i("data"),h+=4,g.setUint32(h,e,!0),h+=4,8===b)for(let a=0;a<d.length;a++,h++){let b=Math.max(-1,Math.min(1,d[a])),c=0>b?32768*b:32767*b;c=parseInt(255/(65535/(c+32768))),g.setInt8(h,c,!0)}else for(let a,b=0;b<d.length;b++,h+=2)a=Math.max(-1,Math.min(1,d[b])),g.setInt16(h,0>a?32768*a:32767*a,!0);return new Blob([g],{type:"audio/wav"})}};this.start=()=>{e.connect(g),g.connect(d.destination)},this.getBlob=()=>h.getBlob(),this.stop=async()=>{g.disconnect(),await d.close(),b.getTracks().forEach(a=>a.stop())},g.onaudioprocess=a=>{h.input(a.inputBuffer.getChannelData(0))}}}(window);